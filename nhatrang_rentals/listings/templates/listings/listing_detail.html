{% extends "listings/base.html" %}

{% block title %}{{ listing.title }} — аренда в Нячанге{% endblock %}

{% block content %}
<a href="{% url 'listings:listing_list' %}" class="back-link">← Назад к списку</a>

<section class="detail-layout" data-listing-id="{{ listing.id }}">
    <div class="detail-main">
        <div class="detail-gallery">
            <div class="carousel" data-carousel>
                <div class="carousel-viewport">
                    <div class="carousel-track">
                        {% for photo in listing.photos.all %}
                            <img src="{{ photo.image.url }}"
                                 alt="{{ listing.title }} фото {{ forloop.counter }}"
                                 class="carousel-slide">
                        {% empty %}
                            <div class="carousel-empty">
                                Нет фотографий
                            </div>
                        {% endfor %}
                    </div>
                    {% if listing.photos.all %}
                        <button class="carousel-fullscreen-btn" type="button" data-carousel-fullscreen-open>
                            ⤢
                        </button>
                    {% endif %}
                </div>
                {% if listing.photos.all %}
                    <button class="carousel-btn carousel-btn-prev" type="button" data-carousel-prev>‹</button>
                    <button class="carousel-btn carousel-btn-next" type="button" data-carousel-next>›</button>
                    <div class="carousel-thumbnails" data-carousel-thumbs></div>
                    <div class="carousel-lightbox" data-carousel-lightbox hidden>
                        <div class="carousel-lightbox-backdrop" data-carousel-fullscreen-close></div>
                        <div class="carousel-lightbox-content">
                            <button class="carousel-lightbox-close" type="button" data-carousel-fullscreen-close>×</button>
                            <img src="" alt="" data-carousel-lightbox-img>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="detail-info">
            <div class="detail-header">
                <h1>{{ listing.title }}</h1>
                <button class="favorite-btn" type="button">
                    <span class="favorite-icon">☆</span>
                    <span class="favorite-text">В избранное</span>
                </button>
            </div>
            <p class="detail-price">{{ listing.price_per_month }} ₽ / месяц</p>
            <p class="detail-address">{{ listing.address }}</p>

            <div class="listing-tags">
                {% for tag in listing.tags.all %}
                    <span class="tag-pill" style="--tag-color: {{ tag.color }}">
                        <span class="tag-pill-icon">{{ tag.icon }}</span>
                        {{ tag.name }}
                    </span>
                {% endfor %}
            </div>

            <div class="detail-description">
                <h2>Описание</h2>
                <p>{{ listing.description|linebreaksbr }}</p>
            </div>

            <button id="telegram-button"
                    type="button"
                    class="btn-telegram">
                <span class="telegram-icon" aria-hidden="true">
                    <svg viewBox="0 0 240 240" xmlns="http://www.w3.org/2000/svg" role="presentation">
                        <path d="M120 0c66.274 0 120 53.726 120 120s-53.726 120-120 120S0 186.274 0 120 53.726 0 120 0zm55.478 79.359c-1.436-1.234-3.598-1.382-5.16-.371L64.56 136.834c-1.686 1.085-2.42 3.101-1.788 4.974.633 1.874 2.439 3.101 4.413 3.038l32.045-1.034 8.263 29.341c.517 1.852 2.198 3.136 4.112 3.14h.039c1.887 0 3.57-1.239 4.126-3.059l12.792-42.101 30.965-29.663c1.843-1.761 1.916-4.667.165-6.51-.646-.676-1.468-1.132-2.357-1.355l-69.191 19.8 55.585-26.118c1.502-.71 2.447-2.217 2.39-3.863-.056-1.646-1.107-3.087-2.66-3.725l-6.858-2.83z"/>
                    </svg>
                </span>
                <span>Связаться в Telegram</span>
            </button>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    window.TELEGRAM_URL = "{{ listing.telegram_url|escapejs }}";
</script>
{% endblock %}
