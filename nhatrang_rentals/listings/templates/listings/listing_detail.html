{% extends "listings/base.html" %}

{% block title %}{{ listing.title }} ‚Äî –∞—Ä–µ–Ω–¥–∞ –≤ –ù—è—á–∞–Ω–≥–µ{% endblock %}

{% block content %}
<a href="{% url 'listings:listing_list' %}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>

<section class="detail-layout" data-listing-id="{{ listing.id }}">
    <div class="detail-main">
        <div class="detail-gallery">
            <div class="carousel" data-carousel>
                <div class="carousel-viewport">
                    <div class="carousel-track">
                        {% for photo in listing.photos.all %}
                            <img src="{{ photo.image.url }}"
                                 alt="{{ listing.title }} —Ñ–æ—Ç–æ {{ forloop.counter }}"
                                 class="carousel-slide">
                        {% empty %}
                            <div class="carousel-empty">
                                –ù–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
                            </div>
                        {% endfor %}
                    </div>
                    {% if listing.photos.all %}
                        <button class="carousel-fullscreen-btn" type="button" data-carousel-fullscreen-open>
                            ‚§¢
                        </button>
                    {% endif %}
                </div>
                {% if listing.photos.all %}
                    <button class="carousel-btn carousel-btn-prev" type="button" data-carousel-prev>‚Äπ</button>
                    <button class="carousel-btn carousel-btn-next" type="button" data-carousel-next>‚Ä∫</button>
                    <div class="carousel-thumbnails" data-carousel-thumbs></div>
                    <div class="carousel-lightbox" data-carousel-lightbox hidden>
                        <div class="carousel-lightbox-backdrop" data-carousel-fullscreen-close></div>
                        <div class="carousel-lightbox-content">
                            <button class="carousel-lightbox-close" type="button" data-carousel-fullscreen-close>√ó</button>
                            <img src="" alt="" data-carousel-lightbox-img>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="detail-info">
            <div class="detail-header">
                <h1>{{ listing.title }}</h1>
                <button class="favorite-btn" type="button">
                    <span class="favorite-icon">‚òÜ</span>
                    <span class="favorite-text">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                </button>
            </div>
            <p class="detail-price">{{ listing.price_per_month }} ‚ÇΩ / –º–µ—Å—è—Ü</p>
            <p class="detail-address">{{ listing.address }}</p>

            <div class="listing-tags">
                {% for tag in listing.tags.all %}
                    <span class="tag-pill" style="--tag-color: {{ tag.color }}">
                        <span class="tag-pill-icon">{{ tag.icon }}</span>
                        {{ tag.name }}
                    </span>
                {% endfor %}
            </div>

            <div class="detail-description">
                <h2>–û–ø–∏—Å–∞–Ω–∏–µ</h2>
                <p>{{ listing.description|linebreaksbr }}</p>
            </div>

            <button id="telegram-button"
                    type="button"
                    class="btn-primary btn-full">
                üí¨ –°–≤—è–∑–∞—Ç—å—Å—è –≤ Telegram
            </button>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    window.TELEGRAM_URL = "{{ listing.telegram_url|escapejs }}";
</script>
{% endblock %}
